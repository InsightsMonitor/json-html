(ns json-html.core-test
  #?(:clj
     (:require
       [json-html.core :refer :all]
       [clojure.test :refer :all])
     :cljs
     (:require
       [json-html.core :refer [edn->html json->html]]
       [cljs.test :refer-macros [is are deftest testing use-fixtures]])))

(def default-test-input
  {"license" "MIT",
   "config"
             {"float" 12.3,
              "what?" "this object is just to show some extra stuff",
              "emptyString" "",
              "emptyObject" {},
              "how?" ["add json.human.js" "add json.human.css" "???" "profit!"],
              "bool" true,
              "integer" 42,
              "customization?" ["customize the css prefix" "change the css file"],
              "htmlEntities" "   <- trailing <em>   & </em> and some html   ",
              "emptyArray" []},
   "dependencies" {"crel" "1.0.0"},
   "author" "Mariano Guerra <mariano@marianoguerra.org>",
   "tags" ["DOM" "HTML" "JSON" "Pretty Print"],
   "repository"
   {"type" "git",
    "url" "git://github.com/marianoguerra/json.human.js.git"},
   "name" "json.human",
   "main" "json.human.js",
   "bugs" {"url" "https://github.com/yogthos/json-html/issues"},
   "version" "0.1.0",
   "contributors" [],
   "description" "Convert\n JSON to human readable\r HTML"})

(def json-input #?(:clj (cheshire.core/encode default-test-input)
                   :cljs (clj->js default-test-input)))

(def expected-output-from-json-clj
  "<div class=\"jh-root\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">author</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">Mariano Guerra &lt;mariano@marianoguerra.org&gt;</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">bugs</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">url</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><a class='jh-type-string-link' href=https://github.com/yogthos/json-html/issues>https://github.com/yogthos/json-html/issues</a></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">config</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">bool</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-bool\">true</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">customization?</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">customize the css prefix</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">change the css file</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">emptyArray</span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-collection\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">emptyObject</span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-map\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">emptyString</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-empty-string\"></span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">float</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-number\">12.3</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">how?</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">add json.human.js</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">add json.human.css</span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">???</span></td></tr><tr><th class=\"jh-key jh-array-key\">3</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">profit!</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">htmlEntities</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">   &lt;- trailing &lt;em&gt;   &amp; &lt;/em&gt; and some html   </span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">integer</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-number\">42</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">what?</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">this object is just to show some extra stuff</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">contributors</span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-collection\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">dependencies</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">crel</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">1.0.0</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">description</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">Convert\n JSON to human readable\r HTML</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">license</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">MIT</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">main</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">json.human.js</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">name</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">json.human</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">repository</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">type</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">git</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">url</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">git://github.com/marianoguerra/json.human.js.git</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">tags</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">DOM</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">HTML</span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">JSON</span></td></tr><tr><th class=\"jh-key jh-array-key\">3</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">Pretty Print</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">version</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">0.1.0</span></td></tr></tbody></table></div>")

(def expected-output-from-json-cljs
  "<div class=\"jh-root\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">author</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">Mariano Guerra &lt;mariano@marianoguerra.org&gt;</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">bugs</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">url</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\"><a class='jh-type-string-link' href=https://github.com/yogthos/json-html/issues>https://github.com/yogthos/json-html/issues</a></span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">config</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">bool</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-bool\">true</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">customization?</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">customize the css prefix</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">change the css file</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">emptyArray</span></span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-collection\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">emptyObject</span></span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-map\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">emptyString</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\"><span class=\"jh-empty-string\"></span></span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">float</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-number\">12.3</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">how?</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">add json.human.js</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">add json.human.css</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">???</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">3</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">profit!</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">htmlEntities</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">   &lt;- trailing &lt;em&gt;   &amp; &lt;/em&gt; and some html   </span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">integer</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-number\">42</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">what?</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">this object is just to show some extra stuff</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">contributors</span></span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-object\"><span class=\"jh-empty-collection\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">dependencies</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">crel</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">1.0.0</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">description</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">Convert\n JSON to human readable\r HTML</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">license</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">MIT</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">main</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">json.human.js</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">name</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">json.human</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">repository</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">type</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">git</span></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">url</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">git://github.com/marianoguerra/json.human.js.git</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">tags</span></span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">DOM</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">HTML</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">JSON</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">3</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">Pretty Print</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">version</span></span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">0.1.0</span></span></td></tr></tbody></table></div>")

(def expected-output-from-edn-clj
  "<div class=\"jh-root\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:date</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-date\">Jan 01, 1979 00:00:00</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:empty-set</span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-set\"><span class=\"jh-empty-set\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:list</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">1</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">2</span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">3</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:map</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:foo</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">bar</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:nil</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-empty\"></span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:object</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\">[1, 2]</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:set</span></th><td class=\"jh-value jh-object-value\"><ul><li class=\"jh-value\"><span class=\"jh-type-number\">1</span></li><li class=\"jh-value\"><span class=\"jh-type-number\">2</span></li><li class=\"jh-value\"><span class=\"jh-type-number\">3</span></li></ul></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:vec</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">a</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">b</span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">c</span></td></tr></tbody></table></td></tr></tbody></table></div>")

(def expected-output-from-edn-cljs
  "<div class=\"jh-root\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:date</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-date\">Mon Jan 01 1979 00:00:00 GMT-0500 (EST)</span></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:empty-set</span></th><td class=\"jh-value jh-object-value\"><div class=\"jh-type-set\"><span class=\"jh-empty-set\"></span></div></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:list</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">1</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">2</span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">3</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:map</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:foo</span></th><td class=\"jh-value jh-object-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">bar</span></span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:nil</span></th><td class=\"jh-value jh-object-value\"></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:object</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">1</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-number\">2</span></td></tr></tbody></table></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:set</span></th><td class=\"jh-value jh-object-value\"><ul><li class=\"jh-value\"><span class=\"jh-type-number\">1</span></li><li class=\"jh-value\"><span class=\"jh-type-number\">2</span></li><li class=\"jh-value\"><span class=\"jh-type-number\">3</span></li></ul></td></tr><tr><th class=\"jh-key jh-object-key\"><span class=\"jh-type-string\">:vec</span></th><td class=\"jh-value jh-object-value\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">a</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">b</span></span></td></tr><tr><th class=\"jh-key jh-array-key\">2</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\"><span class=\"jh-type-string\">c</span></span></td></tr></tbody></table></td></tr></tbody></table></div>")

(def edn-input
  {:date      #?(:clj
                 (.parse (java.text.SimpleDateFormat. "yyyy") "1979")
                 :cljs
                 (js/Date. 1979 0 1 0 0 0 0))
   :map       {:foo "bar"}
   :list      '(1 2 3)
   :vec       [\a \b \c]
   :set       #{1 2 3}
   :empty-set #{}
   :nil       nil
   :object    #?(:clj
                 (doto (java.util.ArrayList.) (.add 1) (.add 2))
                 :cljs
                 #js [1 2])})

(deftest a-test
  (is (= #?(:clj expected-output-from-json-clj :cljs expected-output-from-json-cljs) (json->html json-input)))
  (is (= #?(:clj expected-output-from-edn-clj :cljs expected-output-from-edn-cljs) (edn->html edn-input))))

(deftest extend-uuid
  #?(:clj
     (extend-protocol json-html.core/Render
       java.util.UUID
       (render [u]
         [:span.jh-type-string (str u)]))
     :cljs
     (extend-protocol json-html.core/Render
       cljs.core/UUID
       (render [u]
         [:span.jh-type-string (str u)])))
  (let [uuid #?(:clj (java.util.UUID/randomUUID)
                :cljs (random-uuid))]
    (is (=
          (str
            "<div class=\"jh-root\"><table class=\"jh-type-object\"><tbody><tr><th class=\"jh-key jh-array-key\">0</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">:uuid</span></td></tr><tr><th class=\"jh-key jh-array-key\">1</th><td class=\"jh-value jh-array-value\"><span class=\"jh-type-string\">"
            uuid
            "</span></td></tr></tbody></table></div>")
          (edn->html [:uuid uuid])))))
